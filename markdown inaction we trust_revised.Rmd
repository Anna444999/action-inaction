---
title: "Inaction We Trust"
author: "Adrien Fillon"
date: "27/01/2021"
output:
  pdf_document:
    toc: true
    toc_depth: '3'
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
  word_document:
    toc: true
    toc_depth: '3'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

# When you first set up your project, or if you want to update the environment,
# run the renv initiation
# source("path/to/renv_init_replication.R")

# List of required packages
list_of_packages <- c(
  "report", "dplyr", "psych", "ggplot2", "tidyverse", "corrr", "corrplot",
  "PerformanceAnalytics", "Hmisc", "ggstatsplot", "jtools", "metan",
  "ggthemes", "ggpubr", "apaTables", "insight", "parameters", "pacman"
)

# Install missing packages
pacman::p_load(list_of_packages, character.only = TRUE)

# Global path for saving plots
#plot_save_path <- "C:/Users/Hanna/Downloads"
plot_save_path <- "path/to/your/plots"  # Define the path to save your plots

# Create directory if it does not exist
if (!dir.exists(plot_save_path)) {
  dir.create(plot_save_path, recursive = TRUE)
}

# Set global formatting options
options(scipen = 999, digits = 3)


```

# Study 1a

## Data cleaning and summary statistics
```{r}
# Read the dataset
data1 <- read.csv(
  "inactionwetrust_study1.csv", 
  na.strings = c("", "NA")
)

# Data cleaning: Remove the first row and select relevant columns
data1 <- data1[-1, ] %>%
  select(
    preference, competence, norms, Q55, check1, check2, check3, sex, Age
  )

# Data transformation: Convert relevant columns to numeric and rename 'Q55'
data1 <- data1 %>%
  mutate(
    across(c(preference, competence, norms, Q55, Age), as.numeric)
  ) %>%
  rename(
    regret = Q55
  )

# Summary statistics: Descriptive statistics for selected columns
summary1 <- data1 %>%
  select(preference, competence, norms, regret, sex, Age) %>%
  psych::describe(quant = c(0.25, 0.75)) %>%
  as_tibble(rownames = "rowname")

knitr::kable(
  summary1, 
  digits = 2, 
  caption = "Summary Study 1a", 
  align = "c"
)

# Gender summary: Table summarizing gender distribution
table_gender1 <- table(data1$sex)

knitr::kable(
  table_gender1, 
  digits = 2, 
  caption = "Summary Gender", 
  align = "c"
)

```


## Histograms
```{r}
# Prepare data for faceted histograms
dplot1 <- data1 %>%
  select(preference, competence, norms, regret) %>%
  rename(
    Preference = preference, 
    Competence = competence, 
    Norms = norms, 
    Regret = regret
  ) %>%
  pivot_longer(
    cols = everything(), 
    names_to = "key"
  )

# Set factor levels for the key
dplot1 <- dplot1 %>%
  mutate(
    key = factor(key, levels = c("Preference", "Competence", "Norms", "Regret"))
  )

# Plot multiple histograms with facets
dplot1 %>%
  ggplot(aes(x = value)) +
  facet_wrap(~ key, scales = "free") +
  geom_histogram(binwidth = 1) +
  theme_apa() +
  labs(x = NULL, y = NULL) +
  scale_x_continuous(limits = c(-5, 5)) +
  ylim(0, 200)

# Define variables and their labels
variables <- c("preference", "competence", "norms", "regret")
variable_names <- c("Preference", "Competence", "Norms", "Regret")

# Initialize a list to store plots
plot_list <- vector("list", length(variables))

# Create and store plots using ggstatsplot::gghistostats
for (i in seq_along(variables)) {
  plot_list[[i]] <- ggstatsplot::gghistostats(
    data = data1,
    x = !!rlang::sym(variables[i]),
    xlab = variable_names[i],
    test.value = 0
  )

  # Print and save each plot
  print(plot_list[[i]])

  ggsave(
    filename = file.path(plot_save_path, paste0("Study1a-", variables[i], ".png")),
    plot = plot_list[[i]],
    dpi = 600,
    scale = 1.7
  )
}

# Combine all the plots into one image
combined_plot <- ggpubr::ggarrange(
  plotlist = plot_list,
  common.legend = TRUE
)

# Print and save the combined plot
print(combined_plot)

ggsave(
  filename = file.path(plot_save_path, "Study1a-4_in_one.png"),
  plot = combined_plot,
  width = 11,
  height = 10,
  dpi = 600,
  scale = 1
)

```


## T-Test
```{r}
# Perform t-tests and generate reports
test_results <- lapply(variables, function(var) {
  t.test(data1[[var]], mu = 0)
})

# Generate and print reports for each variable
report_results <- lapply(test_results, report)

names(report_results) <- variables

for (var in variables) {
  cat(paste0("Report for ", var, ":\n"))
  print(report_results[[var]])
  cat("\n")
}

```



